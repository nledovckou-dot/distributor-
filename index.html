<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Changan 2026 — Аналитика звонков</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="page">
      <div class="decor decor--one"></div>
      <div class="decor decor--two"></div>
      <div class="decor decor--three"></div>
      <div class="decor decor--four"></div>
      <header class="hero" id="section-intro">
        <div class="hero__overlay"></div>
        <img class="hero__image" src="brand-cover.png" alt="3D-рендер автомобиля" />
        <div class="hero__content">
          <div class="hero__brand">
            <img class="hero__logo" src="arb-logo.svg" alt="ARB" />
            <span class="hero__tag">Отчет по новым авто</span>
          </div>
          <h1>Аналитический отчет по звонкам новых автомобилей</h1>
          <p class="hero__subtitle">
            Бренд: Changan • Период: декабрь 2025 • Источники: Avito, Auto.ru, Calltouch
          </p>
          <div class="hero__meta">
            <span>Уровень: директор по продажам / коммерческий директор / OEM</span>
            <span>Фокус: только звонки по новым авто</span>
          </div>
          <div class="hero__stats">
            <div class="stat">
              <span class="stat__label">Всего строк в CSV</span>
              <span class="stat__value" id="statTotalRows">—</span>
            </div>
            <div class="stat">
              <span class="stat__label">Звонков с текстом</span>
              <span class="stat__value" id="statWithText">—</span>
            </div>
            <div class="stat">
              <span class="stat__label">Новые авто (анализ)</span>
              <span class="stat__value" id="statNewCarCalls">—</span>
            </div>
            <div class="stat">
              <span class="stat__label">Средняя длит., сек</span>
              <span class="stat__value" id="statAvgDuration">—</span>
            </div>
          </div>
        </div>
        <div class="avatar-player avatar-player--hero" aria-label="Аватар с озвучкой">
          <div class="avatar-player__media">
            <video
              id="avatarMedia"
              data-public-url="https://disk.yandex.ru/i/TVI7ygj8vSkJlw"
              preload="metadata"
              playsinline
            ></video>
          </div>
          <div class="avatar-player__controls">
            <button id="playPauseBtn" class="btn btn--icon" type="button" aria-label="Play">
              <span class="btn__icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" focusable="false">
                  <path d="M8 5v14l11-7z"></path>
                </svg>
              </span>
            </button>
            <span class="avatar-player__status" id="playStatus">Готово к воспроизведению</span>
          </div>
        </div>
      </header>

      <section class="section section--notice" id="section-notice">
        <div class="notice">
          <h2>Ограничения данных</h2>
          <p>
            Отчет построен по сырым данным из файла <span class="mono">calls.csv</span>.
            В анализ включены только звонки по новым автомобилям:
            <strong id="statNewCarInline">—</strong> из
            <strong id="statTotalInline">—</strong> строк (с текстом —
            <strong id="statTextInline">—</strong>). Сервис, б/у и запчасти исключены.
          </p>
        </div>
      </section>

      <section class="section" id="section-1">
        <div class="section__head">
          <h2>1. Темы обращений клиентов по новым автомобилям</h2>
          <p>Классификация тем по интенсивности упоминаний в видимых диалогах.</p>
        </div>
        <div class="legend">
          <h3>Легенда и критерии</h3>
          <p>
            Категория фиксируется, если в тексте звонка есть ключевые слова по теме.
            Один звонок может попадать в несколько тем. Проценты — от базы новых авто.
          </p>
        </div>
        <div class="grid grid--2">
          <div class="card">
            <h3>Распределение тем (индекс 1–5)</h3>
            <canvas id="themesPie" aria-label="Темы обращений"></canvas>
            <p class="note">Индекс основан на формулировках «постоянно / часто / иногда».</p>
            <div class="data-table" id="themesTable" aria-label="Темы и число звонков"></div>
          </div>
          <div class="card">
            <h3>Выводы по темам</h3>
            <ul class="list">
              <li>Доминируют: цена/скидки (<span id="themePriceDominant"></span>).</li>
              <li>Высокая нагрузка: кредит (<span id="themeCreditDominant"></span>).</li>
              <li>До визита хотят закрыть: наличие и сроки (<span id="themeDeliveryDominant"></span>).</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="section-2">
        <div class="section__head">
          <h2>2. Причины недовольства клиентов (только новые авто)</h2>
          <p>Причины, которые реально подтверждаются в тексте расшифровок.</p>
        </div>
        <div class="legend">
          <h3>Легенда и критерии</h3>
          <p>
            Причина фиксируется по явным маркерам недовольства в тексте звонка.
            Категории не взаимоисключающие — один звонок может содержать несколько причин.
          </p>
        </div>
        <div class="grid grid--2">
          <div class="card">
            <h3>Причины недовольства (индекс 0–5)</h3>
            <canvas id="dissatisfactionBar" aria-label="Причины недовольства"></canvas>
            <p class="note">Нулевые значения означают отсутствие подтверждения в данных.</p>
            <div
              class="data-table"
              id="dissatisfactionTable"
              aria-label="Недовольство и число звонков"
            ></div>
          </div>
          <div class="card">
            <h3>Ключевые проблемные зоны</h3>
            <ul class="list">
              <li>Цена выше ожиданий и сравнение с конкурентами.</li>
              <li>Отсутствие нужного авто или комплектации в наличии.</li>
              <li>Долгие сроки поставки и неопределенность по кредиту.</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="section-3">
        <div class="section__head">
          <h2>3. Типы возражений клиентов</h2>
          <p>Возражения, выделенные из реальных формулировок клиентов.</p>
        </div>
        <div class="legend">
          <h3>Легенда и критерии</h3>
          <p>
            Возражение фиксируется при наличии прямой фразы или устойчивого выражения.
            Возможны несколько возражений в одном звонке.
          </p>
        </div>
        <div class="grid grid--2">
          <div class="card">
            <h3>Общее распределение возражений</h3>
            <canvas id="objectionsBar" aria-label="Возражения"></canvas>
            <div
              class="data-table"
              id="objectionsTable"
              aria-label="Возражения и число звонков"
            ></div>
          </div>
          <div class="card">
            <h3>ТОП-5 ключевых возражений</h3>
            <ol class="list list--ordered" id="objectionsTopList"></ol>
          </div>
        </div>
      </section>

      <section class="section" id="section-4">
        <div class="section__head">
          <h2>4. Возражения в разрезе моделей / брендов</h2>
          <p>Сравнение проблем цены и доступности по моделям (если модель указана).</p>
        </div>
        <div class="legend">
          <h3>Легенда и критерии</h3>
          <p>
            Используются только звонки с заполненным полем <span class="mono">model</span>.
            Для каждой модели считаются возражения «дорого» и «долго ждать».
          </p>
        </div>
        <div class="grid grid--2">
          <div class="card">
            <h3>Цена vs наличие (топ-модели)</h3>
            <canvas id="modelObjections" aria-label="Возражения по моделям"></canvas>
            <p class="note">Показаны модели с наибольшим числом звонков в данных.</p>
          </div>
          <div class="card">
            <h3>Таблица по моделям</h3>
            <div class="data-table" id="modelTable" aria-label="Модели и возражения"></div>
          </div>
        </div>
      </section>

      <section class="section" id="section-5">
        <div class="section__head">
          <h2>5. Качество коммуникации операторов / менеджеров</h2>
          <p>Проблемы фиксировались по временным меткам и тексту диалогов.</p>
        </div>
        <div class="legend">
          <h3>Легенда и критерии</h3>
          <ul class="list">
            <li>Пропадает связь — есть фразы про «обрыв», «связь плохая».</li>
            <li>Плохая слышимость — «плохо слышно», «не слышно», «тихо».</li>
            <li>Неуверенная речь — «не знаю», «не в курсе», «не подскажу».</li>
            <li>Быстрый темп речи — просьбы «медленнее», «быстро говорите».</li>
            <li>Перебивание клиента — фразы «не перебивайте», «перебиваете».</li>
            <li>Длинные паузы — разрыв между репликами &ge; 25 секунд по тайм‑меткам.</li>
            <li>Нет фиксации шага — нет фраз про визит/запись/перезвон в конце.</li>
          </ul>
        </div>
        <div class="grid grid--3">
          <div class="card">
            <h3>Типовые проблемы (индекс 1–5)</h3>
            <canvas id="qualityBar" aria-label="Качество коммуникации"></canvas>
            <div
              class="data-table"
              id="qualityTable"
              aria-label="Коммуникация и число звонков"
            ></div>
            <p class="note">Длинные паузы: разрыв между репликами &ge; 25 сек.</p>
          </div>
          <div class="card">
            <h3>Паттерны ошибок</h3>
            <ul class="list">
              <li>Долгие паузы при поиске информации в системе.</li>
              <li>Соединение с менеджером занимает 30+ секунд.</li>
              <li>Звонок завершается без фиксации следующего шага.</li>
            </ul>
            <div class="callout">
              <span class="callout__label">Доля проблемных звонков</span>
              <span class="callout__value" id="problemShare">—</span>
            </div>
          </div>
          <div class="card">
            <h3>Рейтинг операторов</h3>
            <div class="data-table" id="operatorsTable" aria-label="Рейтинг операторов"></div>
            <p class="note">Рейтинг рассчитан по количеству звонков с проблемами.</p>
          </div>
        </div>
      </section>

      <section class="section" id="section-6">
        <div class="section__head">
          <h2>6. Причины длинных и неэффективных звонков</h2>
          <p>Факторы, повышающие длительность и нагрузку на операторов.</p>
        </div>
        <div class="legend">
          <h3>Легенда и критерии</h3>
          <p>
            «Длинный звонок» — длительность выше среднего по новым авто:
            <span id="avgDurationInline">—</span> сек. Причины определяются по ключевым словам.
          </p>
        </div>
        <div class="grid grid--2">
          <div class="card">
            <h3>Структура причин (stacked)</h3>
            <canvas id="longCallsStacked" aria-label="Причины длинных звонков"></canvas>
            <div
              class="data-table"
              id="longCallsTable"
              aria-label="Причины длинных звонков и число звонков"
            ></div>
            <p class="note">Длинные звонки: <span id="longCallsTotal">—</span>.</p>
          </div>
          <div class="card">
            <h3>Выявленные причины</h3>
            <ul class="list">
              <li>Ручные расчеты кредита и сравнение сценариев.</li>
              <li>Уточнение деталей трейд-ин и истории автомобиля.</li>
              <li>Поиск информации по наличию и ценам в реальном времени.</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="section-7">
        <div class="section__head">
          <h2>7. Дополнительные связи для управленческих решений</h2>
          <p>Каскады проблем, выявленные в текстах диалогов.</p>
        </div>
        <div class="legend">
          <h3>Легенда и критерии</h3>
          <p>
            Связи построены на пересечении тем и возражений в одном звонке.
            Показываются категории с максимальными пересечениями.
          </p>
        </div>
        <div class="grid grid--2">
          <div class="card">
            <h3>Связи спроса и конверсии</h3>
            <ul class="list">
              <li>«Цена / скидки» ( <span id="themePrice"></span> ) усиливает «дорого» и сравнение.</li>
              <li>Дефицит наличия ( <span id="themeStock"></span> ) повышает «долго ждать».</li>
              <li>Кредитные вопросы ( <span id="themeCredit"></span> ) тянут длительность звонков.</li>
            </ul>
          </div>
          <div class="card">
            <h3>Связи процессов колл-центра</h3>
            <ul class="list">
              <li>Длинные паузы: <span id="qualityPauses"></span> звонков.</li>
              <li>Ручной расчет кредита: <span id="longManualCredit"></span> длинных звонков.</li>
              <li>Нет следующего шага: <span id="qualityNoNext"></span> звонков.</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="section-8">
        <div class="section__head">
          <h2>8. Итоговые управленческие выводы</h2>
          <p>Сводные управленческие приоритеты, основанные на видимых данных.</p>
        </div>
        <div class="legend">
          <h3>Легенда и критерии</h3>
          <p>
            ТОП‑блоки сформированы по частоте упоминаний в соответствующих категориях.
            В каждой позиции указано количество и доля звонков.
          </p>
        </div>
        <div class="grid grid--3">
          <div class="card">
            <h3>ТОП-5 причин потери сделок</h3>
            <ul class="list">
              <li>Цена выше ожиданий: <span id="lossPrice"></span>.</li>
              <li>Отсутствие авто в наличии: <span id="lossStock"></span>.</li>
              <li>Долгие сроки поставки: <span id="lossDelivery"></span>.</li>
              <li>Нет нужной комплектации: <span id="lossTrim"></span>.</li>
              <li>Неопределенность по кредиту: <span id="lossCredit"></span>.</li>
            </ul>
          </div>
          <div class="card">
            <h3>ТОП-5 факторов длинных звонков</h3>
            <ul class="list">
              <li>Ручной расчет кредита: <span id="longManual"></span>.</li>
              <li>Поиск актуального наличия: <span id="longStock"></span>.</li>
              <li>Несовпадение цены на сайте: <span id="longSitePrice"></span>.</li>
              <li>Нет чёткого сценария: <span id="longNoScript"></span>.</li>
              <li>Сложность кредитных условий: <span id="longCreditExplain"></span>.</li>
            </ul>
          </div>
          <div class="card">
            <h3>Критические зоны</h3>
            <ul class="list">
              <li>Продукт: цена (<span id="critPrice"></span>).</li>
              <li>Продажи: нет следующего шага (<span id="critNext"></span>).</li>
              <li>Кредит: условия и расчеты (<span id="critCredit"></span>).</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="section-9">
        <div class="section__head">
          <h2>9. Рекомендации</h2>
          <p>Приоритетные действия для роста конверсии звонок → визит.</p>
        </div>
        <div class="legend">
          <h3>Легенда и критерии</h3>
          <p>
            Рекомендации основаны на темах с максимальной долей звонков и причинах
            длинных разговоров. Это управляемые действия на сайте и в скриптах.
          </p>
        </div>
        <div class="grid grid--2">
          <div class="card">
            <h3>Сайт и цифровые каналы</h3>
            <ul class="list">
              <li>Калькулятор кредита с реальными ставками и взносами.</li>
              <li>Онлайн-наличие по модели/комплектации в реальном времени.</li>
              <li>Прозрачные цены с указанием условий скидок и акций.</li>
              <li>Быстрые ответы по срокам поставки до звонка.</li>
            </ul>
          </div>
          <div class="card">
            <h3>Скрипты и процесс продаж</h3>
            <ul class="list">
              <li>Готовые ответы на ТОП-5 возражений.</li>
              <li>Стандарт фиксации следующего шага (визит/бронь).</li>
              <li>Единый пакет данных по цене и наличию в начале смены.</li>
              <li>Автоматизация расчетов кредита и трейд-ин.</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section section--footer" id="section-final">
        <div class="footer">
          <div>
            <h2>Контекст</h2>
            <p>
              Отчет подготовлен для печати в PDF из браузера. Источник данных:
              <span class="mono">Report_Changan_2026.tex</span>.
            </p>
          </div>
          <div class="footer__meta">
            <span>Дата: 21 января 2026</span>
            <span>Статус: подтверждено по видимым транскрипциям</span>
          </div>
        </div>
      </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
      const reportData = {
        "total_rows": 59293,
        "total_with_text": 47595,
        "new_car_calls": 12862,
        "avg_duration": 265.93,
        "problem_calls_total": 11203,
        "problem_calls_share": 87.1,
        "themes": {
          "Наличие автомобиля": {
            "count": 3649,
            "pct": 28.37
          },
          "Цена / скидки / акции": {
            "count": 5873,
            "pct": 45.66
          },
          "Сроки поставки": {
            "count": 4731,
            "pct": 36.78
          },
          "Комплектации и опции": {
            "count": 3672,
            "pct": 28.55
          },
          "Автокредит": {
            "count": 5087,
            "pct": 39.55
          },
          "Трейд-ин": {
            "count": 4235,
            "pct": 32.93
          },
          "Запись в дилерский центр": {
            "count": 11344,
            "pct": 88.2
          },
          "Статус заявки": {
            "count": 3273,
            "pct": 25.45
          },
          "Отказ / отмена": {
            "count": 2346,
            "pct": 18.24
          },
          "Сравнение с конкурентами": {
            "count": 1705,
            "pct": 13.26
          }
        },
        "themes_other": {
          "count": 536,
          "pct": 4.17
        },
        "dissatisfaction": {
          "Цена выше ожиданий": {
            "count": 1393,
            "pct": 10.83
          },
          "Отсутствие автомобиля в наличии": {
            "count": 311,
            "pct": 2.42
          },
          "Долгий срок поставки": {
            "count": 87,
            "pct": 0.68
          },
          "Нет нужной комплектации": {
            "count": 9,
            "pct": 0.07
          },
          "Неоднозначные условия кредита": {
            "count": 352,
            "pct": 2.74
          },
          "Навязывание доп.услуг": {
            "count": 238,
            "pct": 1.85
          },
          "Конкуренты предлагают лучше": {
            "count": 120,
            "pct": 0.93
          },
          "Недостаточная компетентность": {
            "count": 646,
            "pct": 5.02
          },
          "Проблемы с сайтом": {
            "count": 1203,
            "pct": 9.35
          }
        },
        "objections": {
          "Дорого": {
            "count": 1389,
            "pct": 10.8
          },
          "Долго ждать": {
            "count": 2154,
            "pct": 16.75
          },
          "Нет нужной комплектации": {
            "count": 9,
            "pct": 0.07
          },
          "Конкуренты предлагают выгоднее": {
            "count": 1433,
            "pct": 11.14
          },
          "Я подумаю": {
            "count": 2223,
            "pct": 17.28
          },
          "Не сейчас": {
            "count": 5633,
            "pct": 43.8
          },
          "Хочу другой бренд / модель": {
            "count": 40,
            "pct": 0.31
          },
          "Не устраивают условия кредита": {
            "count": 228,
            "pct": 1.77
          }
        },
        "quality": {
          "Пропадает связь": {
            "count": 65,
            "pct": 0.51
          },
          "Плохая слышимость": {
            "count": 715,
            "pct": 5.56
          },
          "Неуверенная речь": {
            "count": 3441,
            "pct": 26.75
          },
          "Быстрый темп речи": {
            "count": 13,
            "pct": 0.1
          },
          "Перебивание клиента": {
            "count": 8,
            "pct": 0.06
          },
          "Длинные паузы": {
            "count": 10249,
            "pct": 79.68
          },
          "Нет фиксации следующего шага": {
            "count": 1367,
            "pct": 10.63
          }
        },
        "long_calls": {
          "total": 5289,
          "reasons": {
            "Нет актуального наличия авто": {
              "count": 748,
              "pct": 14.14
            },
            "Несовпадение цены на сайте": {
              "count": 1064,
              "pct": 20.12
            },
            "Сложное объяснение кредитных условий": {
              "count": 3468,
              "pct": 65.57
            },
            "Ручной расчёт кредита": {
              "count": 1348,
              "pct": 25.49
            },
            "Нет чёткого сценария консультации": {
              "count": 1234,
              "pct": 23.33
            }
          }
        },
        "model_objections": {
          "UNI-S (CS55 Plus)": {
            "price": 294,
            "availability": 307,
            "total": 1426
          },
          "CS35 Plus": {
            "price": 157,
            "availability": 151,
            "total": 768
          },
          "UNI-V": {
            "price": 72,
            "availability": 103,
            "total": 526
          },
          "CS75 Plus": {
            "price": 86,
            "availability": 82,
            "total": 506
          },
          "UNI-K": {
            "price": 64,
            "availability": 91,
            "total": 495
          },
          "Hunter Plus": {
            "price": 65,
            "availability": 73,
            "total": 429
          }
        },
        "operator_ranking": [
          {
            "operator": "Не определен",
            "problem_calls": 5631,
            "total_calls": 6906,
            "share": 81.54
          },
          {
            "operator": "Елена",
            "problem_calls": 183,
            "total_calls": 210,
            "share": 87.14
          },
          {
            "operator": "Анастасия",
            "problem_calls": 162,
            "total_calls": 174,
            "share": 93.1
          },
          {
            "operator": "Сергей",
            "problem_calls": 146,
            "total_calls": 153,
            "share": 95.42
          },
          {
            "operator": "Лиля",
            "problem_calls": 145,
            "total_calls": 151,
            "share": 96.03
          },
          {
            "operator": "Наталья",
            "problem_calls": 138,
            "total_calls": 141,
            "share": 97.87
          },
          {
            "operator": "Екатерина",
            "problem_calls": 137,
            "total_calls": 159,
            "share": 86.16
          },
          {
            "operator": "Татьяна",
            "problem_calls": 130,
            "total_calls": 150,
            "share": 86.67
          },
          {
            "operator": "Диана",
            "problem_calls": 129,
            "total_calls": 130,
            "share": 99.23
          },
          {
            "operator": "Виктория",
            "problem_calls": 129,
            "total_calls": 141,
            "share": 91.49
          }
        ]
      };

      const palette = {
        accents: ["#ff3b3b", "#ff6b6b", "#f1f5f9", "#cbd5e1", "#94a3b8", "#6b7280"],
        muted: "#8a9099",
        grid: "rgba(255, 255, 255, 0.08)",
      };

      Chart.defaults.color = "#e6e9ef";
      Chart.defaults.font.family = "Inter, Arial, sans-serif";
      Chart.defaults.borderColor = palette.grid;

      const formatNumber = (value) =>
        Number(value).toLocaleString("ru-RU", { maximumFractionDigits: 2 });
      const formatPercent = (value) =>
        `${Number(value).toLocaleString("ru-RU", { maximumFractionDigits: 2 })}%`;

      const setText = (id, value) => {
        const el = document.getElementById(id);
        if (el) el.textContent = value;
      };

      setText("statTotalRows", formatNumber(reportData.total_rows));
      setText("statWithText", formatNumber(reportData.total_with_text));
      setText("statNewCarCalls", formatNumber(reportData.new_car_calls));
      setText("statAvgDuration", formatNumber(reportData.avg_duration));
      setText("avgDurationInline", formatNumber(reportData.avg_duration));
      setText("statNewCarInline", `${formatNumber(reportData.new_car_calls)}`);
      setText("statTotalInline", `${formatNumber(reportData.total_rows)}`);
      setText("statTextInline", `${formatNumber(reportData.total_with_text)}`);
      setText("problemShare", formatPercent(reportData.problem_calls_share));
      setText("longCallsTotal", formatNumber(reportData.long_calls.total));

      const highlightRegistry = {};
      const registerHighlight = (key, element) => {
        if (!element || !key) return;
        highlightRegistry[key] = highlightRegistry[key] || [];
        highlightRegistry[key].push(element);
      };

      const ensureBadge = () => {
        const notice = document.querySelector("#section-notice .notice");
        if (!notice) return;
        let badge = document.getElementById("badgeNewCars");
        if (!badge) {
          badge = document.createElement("span");
          badge.id = "badgeNewCars";
          badge.className = "badge";
          badge.textContent = "Только новые авто";
          notice.appendChild(badge);
        }
        badge.dataset.key = "badge-new-cars";
      };

      const ensureSummary = () => {
        const summaryList = document.querySelector("#section-1 .card:last-child .list");
        if (!summaryList) return;
        const items = Array.from(summaryList.querySelectorAll("li"));
        if (items.length < 4) {
          const li = document.createElement("li");
          li.textContent = "И ключевой фильтр: наличие";
          summaryList.appendChild(li);
        }
        const updatedItems = Array.from(summaryList.querySelectorAll("li"));
        if (updatedItems[0]) updatedItems[0].dataset.key = "summary-price";
        if (updatedItems[1]) updatedItems[1].dataset.key = "summary-credit";
        if (updatedItems[2]) updatedItems[2].dataset.key = "summary-delivery";
        if (updatedItems[3]) updatedItems[3].dataset.key = "summary-stock";

        let stockSpan = document.getElementById("themeStockSummary");
        if (!stockSpan && updatedItems[3]) {
          stockSpan = document.createElement("span");
          stockSpan.id = "themeStockSummary";
          stockSpan.className = "mono";
          updatedItems[3].append(" (", stockSpan, ")");
        }
      };

      const ensureRecommendations = () => {
        const list = document.querySelector("#section-9 .card:first-child .list");
        if (!list) return;
        const items = [
          { key: "rec-credit", text: "Удобный расчет кредита." },
          { key: "rec-stock", text: "Синхронизация наличия на сайте." },
          { key: "rec-next", text: "Фиксация следующего шага." },
          { key: "rec-objections", text: "Четкие ответы на «дорого», «не сейчас», «долго ждать»." },
        ];
        list.innerHTML = "";
        items.forEach((item) => {
          const li = document.createElement("li");
          li.dataset.key = item.key;
          li.textContent = item.text;
          list.appendChild(li);
        });
      };

      const tagListByKeywords = (selector, map) => {
        const list = document.querySelector(selector);
        if (!list) return;
        list.querySelectorAll("li").forEach((li) => {
          const text = li.textContent.toLowerCase();
          Object.entries(map).forEach(([key, keyword]) => {
            if (text.includes(keyword)) li.dataset.key = key;
          });
        });
      };

      ensureBadge();
      ensureSummary();
      ensureRecommendations();

      const parseTime = (value) => {
        const [min, sec] = value.split(":").map(Number);
        return min * 60 + sec;
      };

      const segments = [
        { label: "Вступление", start: parseTime("0:00"), end: parseTime("0:05"), sectionId: "section-intro", highlights: [] },
        { label: "Фокус", start: parseTime("0:05"), end: parseTime("0:10"), sectionId: "section-notice", highlights: ["badge-new-cars"] },
        { label: "Темы: запись", start: parseTime("0:10"), end: parseTime("0:14"), sectionId: "section-1", highlights: ["theme-booking"] },
        { label: "Темы: цена", start: parseTime("0:14"), end: parseTime("0:17"), sectionId: "section-1", highlights: ["theme-price"] },
        { label: "Темы: кредит", start: parseTime("0:17"), end: parseTime("0:19"), sectionId: "section-1", highlights: ["theme-credit"] },
        { label: "Темы: сроки", start: parseTime("0:19"), end: parseTime("0:21"), sectionId: "section-1", highlights: ["theme-delivery"] },
        { label: "Темы: трейд-ин", start: parseTime("0:21"), end: parseTime("0:23"), sectionId: "section-1", highlights: ["theme-tradein"] },
        { label: "Темы: комплектации", start: parseTime("0:23"), end: parseTime("0:24"), sectionId: "section-1", highlights: ["theme-trim"] },
        { label: "Темы: наличие", start: parseTime("0:24"), end: parseTime("0:25"), sectionId: "section-1", highlights: ["theme-stock"] },
        { label: "Итог по темам", start: parseTime("0:25"), end: parseTime("0:30"), sectionId: "section-1", highlights: ["summary-price", "summary-credit", "summary-delivery", "summary-stock"] },
        { label: "Недовольство: дорого", start: parseTime("0:30"), end: parseTime("0:34"), sectionId: "section-2", highlights: ["dissat-expensive"] },
        { label: "Недовольство: сайт", start: parseTime("0:34"), end: parseTime("0:38"), sectionId: "section-2", highlights: ["dissat-site"] },
        { label: "Недовольство: консультация", start: parseTime("0:38"), end: parseTime("0:42"), sectionId: "section-2", highlights: ["dissat-consult"] },
        { label: "Возражения: не сейчас", start: parseTime("0:42"), end: parseTime("0:44"), sectionId: "section-3", highlights: ["obj-not-now"] },
        { label: "Возражения: подумаю", start: parseTime("0:44"), end: parseTime("0:46"), sectionId: "section-3", highlights: ["obj-think"] },
        { label: "Возражения: долго ждать", start: parseTime("0:46"), end: parseTime("0:47"), sectionId: "section-3", highlights: ["obj-wait"] },
        { label: "Возражения: конкуренты", start: parseTime("0:47"), end: parseTime("0:48"), sectionId: "section-3", highlights: ["obj-competitors"] },
        { label: "Возражения: дорого", start: parseTime("0:48"), end: parseTime("0:49"), sectionId: "section-3", highlights: ["obj-expensive"] },
        { label: "Итог по возражениям", start: parseTime("0:49"), end: parseTime("0:56"), sectionId: "section-3", highlights: ["objectionsTopList"] },
        { label: "Модели: цена", start: parseTime("0:56"), end: parseTime("1:00"), sectionId: "section-4", highlights: ["model-price"] },
        { label: "Модели: наличие", start: parseTime("1:00"), end: parseTime("1:04"), sectionId: "section-4", highlights: ["model-availability"] },
        { label: "Модели: UNI-S", start: parseTime("1:04"), end: parseTime("1:06"), sectionId: "section-4", highlights: ["model-uni-s"] },
        { label: "Качество: паузы", start: parseTime("1:06"), end: parseTime("1:10"), sectionId: "section-5", highlights: ["quality-pauses"] },
        { label: "Качество: неуверенность", start: parseTime("1:10"), end: parseTime("1:13"), sectionId: "section-5", highlights: ["quality-uncertain"] },
        { label: "Качество: следующий шаг", start: parseTime("1:13"), end: parseTime("1:16"), sectionId: "section-5", highlights: ["quality-next"] },
        { label: "Длинные: кредит", start: parseTime("1:16"), end: parseTime("1:21"), sectionId: "section-6", highlights: ["long-credit"] },
        { label: "Длинные: ручные расчеты", start: parseTime("1:21"), end: parseTime("1:24"), sectionId: "section-6", highlights: ["long-manual"] },
        { label: "Длинные: расхождение цен", start: parseTime("1:24"), end: parseTime("1:27"), sectionId: "section-6", highlights: ["long-site"] },
        { label: "Длинные: нет сценария", start: parseTime("1:27"), end: parseTime("1:30"), sectionId: "section-6", highlights: ["long-noscript"] },
        { label: "Связка: цена", start: parseTime("1:30"), end: parseTime("1:34"), sectionId: "section-7", highlights: ["chain-price"] },
        { label: "Связка: наличие", start: parseTime("1:34"), end: parseTime("1:38"), sectionId: "section-7", highlights: ["chain-stock"] },
        { label: "Связка: кредит", start: parseTime("1:38"), end: parseTime("1:42"), sectionId: "section-7", highlights: ["chain-credit"] },
        { label: "Потери: цена", start: parseTime("1:42"), end: parseTime("1:44"), sectionId: "section-8", highlights: ["loss-price"] },
        { label: "Потери: наличие", start: parseTime("1:44"), end: parseTime("1:46"), sectionId: "section-8", highlights: ["loss-stock"] },
        { label: "Потери: сроки", start: parseTime("1:46"), end: parseTime("1:48"), sectionId: "section-8", highlights: ["loss-delivery"] },
        { label: "Потери: комплектация", start: parseTime("1:48"), end: parseTime("1:50"), sectionId: "section-8", highlights: ["loss-trim"] },
        { label: "Потери: кредит", start: parseTime("1:50"), end: parseTime("1:52"), sectionId: "section-8", highlights: ["loss-credit"] },
        { label: "Рекомендации: кредит", start: parseTime("1:52"), end: parseTime("1:56"), sectionId: "section-9", highlights: ["rec-credit"] },
        { label: "Рекомендации: наличие", start: parseTime("1:56"), end: parseTime("2:00"), sectionId: "section-9", highlights: ["rec-stock"] },
        { label: "Рекомендации: следующий шаг", start: parseTime("2:00"), end: parseTime("2:03"), sectionId: "section-9", highlights: ["rec-next"] },
        { label: "Рекомендации: ответы", start: parseTime("2:03"), end: parseTime("2:05"), sectionId: "section-9", highlights: ["rec-objections"] },
        { label: "Финал", start: parseTime("2:05"), end: parseTime("2:10"), sectionId: "section-final", highlights: [] },
      ];
      const activeTimeline = segments;

      const media = document.getElementById("avatarMedia");
      const playPauseBtn = document.getElementById("playPauseBtn");
      const playStatus = document.getElementById("playStatus");
      let activeIndex = -1;

      const clearHighlights = () => {
        document.querySelectorAll(".section.is-active, .hero.is-active").forEach((el) => {
          el.classList.remove("is-active");
        });
        document.querySelectorAll(".is-highlight").forEach((el) => {
          el.classList.remove("is-highlight");
        });
      };

      const highlightByKey = (key) => {
        if (!key) return;
        const direct = document.querySelectorAll(`[data-key="${key}"]`);
        direct.forEach((el) => el.classList.add("is-highlight"));
        const byId = document.getElementById(key);
        if (byId) byId.classList.add("is-highlight");
        const registry = highlightRegistry[key] || [];
        registry.forEach((el) => el.classList.add("is-highlight"));
      };

      const applySegment = (index) => {
        if (index === activeIndex) return;
        activeIndex = index;
        clearHighlights();
        const segment = activeTimeline[index];
        if (!segment) return;
        const section = document.getElementById(segment.sectionId);
        if (section) {
          section.classList.add("is-active");
          if (media && !media.paused) {
            section.scrollIntoView({ behavior: "smooth", block: "start" });
          }
        }
        segment.highlights.forEach((key) => highlightByKey(key));
        if (playStatus) playStatus.textContent = `Сейчас: ${segment.label}`;
      };

      const syncByTime = (currentTime) => {
        const index = activeTimeline.findIndex(
          (seg) => currentTime >= seg.start && currentTime < seg.end
        );
        if (index !== -1) {
          applySegment(index);
        }
      };

      if (media && playPauseBtn) {
        const ensureMediaSource = async () => {
          if (media.getAttribute("src")) return true;
          const publicUrl = media.dataset.publicUrl;
          if (!publicUrl) return false;
          if (playStatus) playStatus.textContent = "Загружаю видео...";
          try {
            const response = await fetch(
              `https://cloud-api.yandex.net/v1/disk/public/resources/download?public_key=${encodeURIComponent(
                publicUrl
              )}`
            );
            if (!response.ok) throw new Error("download-link-error");
            const data = await response.json();
            if (!data.href) throw new Error("download-link-missing");
            media.src = data.href;
            media.load();
            return true;
          } catch (err) {
            if (playStatus) {
              playStatus.textContent = "Не удалось загрузить видео. Проверьте доступ по ссылке.";
            }
            return false;
          }
        };
        const setButtonState = (state) => {
          playPauseBtn.setAttribute("aria-label", state === "playing" ? "Stop" : "Play");
          const icon = playPauseBtn.querySelector("svg path");
          if (!icon) return;
          if (state === "playing") {
            icon.setAttribute("d", "M6 5h4v14H6zM14 5h4v14h-4z");
          } else {
            icon.setAttribute("d", "M8 5v14l11-7z");
          }
        };

        playPauseBtn.addEventListener("click", async () => {
          if (media.paused) {
            const ready = await ensureMediaSource();
            if (ready) {
              media.play();
            }
          } else {
            media.pause();
            media.currentTime = 0;
          }
        });

        media.addEventListener("play", () => {
          setButtonState("playing");
        });

        media.addEventListener("pause", () => {
          setButtonState("paused");
        });

        media.addEventListener("ended", () => {
          playPauseBtn.textContent = "Play";
          if (playStatus) playStatus.textContent = "Готово к воспроизведению";
          clearHighlights();
        });

        media.addEventListener("error", () => {
          if (playStatus) playStatus.textContent = "Ошибка воспроизведения видео.";
        });

        media.addEventListener("timeupdate", () => {
          syncByTime(media.currentTime);
        });

        media.addEventListener("loadedmetadata", () => {
          syncByTime(0);
        });
      }

      const themes = Object.entries(reportData.themes).map(([label, item]) => ({
        label,
        count: item.count,
        pct: item.pct,
      }));
      themes.push({
        label: "Прочее",
        count: reportData.themes_other.count,
        pct: reportData.themes_other.pct,
      });

      const buildTable = (containerId, rows, keyMap = {}) => {
        const container = document.getElementById(containerId);
        if (!container) return;
        const table = document.createElement("table");
        const thead = document.createElement("thead");
        thead.innerHTML = "<tr><th>Категория</th><th>Звонки</th><th>%</th></tr>";
        const tbody = document.createElement("tbody");
        rows.forEach((row) => {
          const tr = document.createElement("tr");
          const key = keyMap[row.label];
          if (key) tr.dataset.key = key;
          tr.innerHTML = `<td>${row.label}</td><td>${formatNumber(row.count)}</td><td>${formatPercent(row.pct)}</td>`;
          tbody.appendChild(tr);
        });
        table.appendChild(thead);
        table.appendChild(tbody);
        container.innerHTML = "";
        container.appendChild(table);
      };

      const themeKeyMap = {
        "Запись в дилерский центр": "theme-booking",
        "Цена / скидки / акции": "theme-price",
        "Автокредит": "theme-credit",
        "Сроки поставки": "theme-delivery",
        "Трейд-ин": "theme-tradein",
        "Комплектации и опции": "theme-trim",
        "Наличие автомобиля": "theme-stock",
      };
      buildTable("themesTable", themes.sort((a, b) => b.count - a.count), themeKeyMap);

      const dissatRows = Object.entries(reportData.dissatisfaction).map(([label, item]) => ({
        label,
        count: item.count,
        pct: item.pct,
      }));
      const dissatKeyMap = {
        "Цена выше ожиданий": "dissat-expensive",
        "Проблемы с сайтом": "dissat-site",
        "Недостаточная компетентность": "dissat-consult",
      };
      buildTable("dissatisfactionTable", dissatRows.sort((a, b) => b.count - a.count), dissatKeyMap);

      const objectionsRows = Object.entries(reportData.objections).map(([label, item]) => ({
        label,
        count: item.count,
        pct: item.pct,
      }));
      const objectionsKeyMap = {
        "Не сейчас": "obj-not-now",
        "Я подумаю": "obj-think",
        "Долго ждать": "obj-wait",
        "Конкуренты предлагают выгоднее": "obj-competitors",
        "Дорого": "obj-expensive",
      };
      buildTable("objectionsTable", objectionsRows.sort((a, b) => b.count - a.count), objectionsKeyMap);

      const qualityRows = Object.entries(reportData.quality).map(([label, item]) => ({
        label,
        count: item.count,
        pct: item.pct,
      }));
      const qualityKeyMap = {
        "Длинные паузы": "quality-pauses",
        "Неуверенная речь": "quality-uncertain",
        "Нет фиксации следующего шага": "quality-next",
      };
      buildTable("qualityTable", qualityRows.sort((a, b) => b.count - a.count), qualityKeyMap);

      const longRows = Object.entries(reportData.long_calls.reasons).map(([label, item]) => ({
        label,
        count: item.count,
        pct: item.pct,
      }));
      const longKeyMap = {
        "Сложное объяснение кредитных условий": "long-credit",
        "Ручной расчёт кредита": "long-manual",
        "Несовпадение цены на сайте": "long-site",
        "Нет чёткого сценария консультации": "long-noscript",
      };
      buildTable("longCallsTable", longRows.sort((a, b) => b.count - a.count), longKeyMap);

      const modelRows = Object.entries(reportData.model_objections).map(([label, item]) => ({
        label,
        count: item.total,
        price: item.price,
        availability: item.availability,
      }));
      const modelTable = document.getElementById("modelTable");
      if (modelTable) {
        const table = document.createElement("table");
        table.innerHTML =
          "<thead><tr><th>Модель</th><th>Всего</th><th>Цена</th><th>Наличие</th></tr></thead>";
        const tbody = document.createElement("tbody");
        modelRows.forEach((row) => {
          const tr = document.createElement("tr");
          if (row.label === "UNI-S (CS55 Plus)") tr.dataset.key = "model-uni-s";
          tr.innerHTML = `<td>${row.label}</td><td>${formatNumber(row.count)}</td><td>${formatNumber(
            row.price
          )}</td><td>${formatNumber(row.availability)}</td>`;
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        modelTable.innerHTML = "";
        modelTable.appendChild(table);
      }

      const operatorsTable = document.getElementById("operatorsTable");
      if (operatorsTable) {
        const table = document.createElement("table");
        table.innerHTML =
          "<thead><tr><th>Оператор</th><th>Проблемные</th><th>Всего</th><th>%</th></tr></thead>";
        const tbody = document.createElement("tbody");
        reportData.operator_ranking.forEach((row) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${row.operator}</td><td>${formatNumber(
            row.problem_calls
          )}</td><td>${formatNumber(row.total_calls)}</td><td>${formatPercent(row.share)}</td>`;
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        operatorsTable.innerHTML = "";
        operatorsTable.appendChild(table);
      }

      const topObjections = [...objectionsRows].sort((a, b) => b.count - a.count).slice(0, 5);
      const topList = document.getElementById("objectionsTopList");
      if (topList) {
        topList.innerHTML = "";
        topObjections.forEach((row) => {
          const li = document.createElement("li");
          const key = objectionsKeyMap[row.label];
          if (key) li.dataset.key = key;
          li.textContent = `${row.label} — ${formatNumber(row.count)} (${formatPercent(row.pct)})`;
          topList.appendChild(li);
        });
      }

      registerHighlight("model-price", document.getElementById("modelObjections"));
      registerHighlight("model-availability", document.getElementById("modelObjections"));

      tagListByKeywords("#section-7 .card:first-child .list", {
        "chain-price": "цена →",
        "chain-stock": "нет наличия",
        "chain-credit": "кредит →",
      });

      tagListByKeywords("#section-8 .card:first-child .list", {
        "loss-price": "цена выше",
        "loss-stock": "налич",
        "loss-delivery": "срок",
        "loss-trim": "комплектац",
        "loss-credit": "кредит",
      });

      tagListByKeywords("#section-9 .card:first-child .list", {
        "rec-credit": "кредит",
        "rec-stock": "налич",
        "rec-next": "следующ",
        "rec-objections": "возраж",
      });

      const getTheme = (label) => reportData.themes[label] || { count: 0, pct: 0 };
      const getQuality = (label) => reportData.quality[label] || { count: 0, pct: 0 };
      const getLong = (label) => reportData.long_calls.reasons[label] || { count: 0, pct: 0 };
      const getObj = (label) => reportData.objections[label] || { count: 0, pct: 0 };
      const getDissat = (label) => reportData.dissatisfaction[label] || { count: 0, pct: 0 };

      setText("themePriceDominant", `${formatNumber(getTheme("Цена / скидки / акции").count)} (${formatPercent(getTheme("Цена / скидки / акции").pct)})`);
      setText("themeCreditDominant", `${formatNumber(getTheme("Автокредит").count)} (${formatPercent(getTheme("Автокредит").pct)})`);
      setText("themeDeliveryDominant", `${formatNumber(getTheme("Сроки поставки").count)} (${formatPercent(getTheme("Сроки поставки").pct)})`);
      setText("themeStockSummary", `${formatNumber(getTheme("Наличие автомобиля").count)} (${formatPercent(getTheme("Наличие автомобиля").pct)})`);

      setText("themePrice", `${formatNumber(getTheme("Цена / скидки / акции").count)} звонков`);
      setText("themeStock", `${formatNumber(getTheme("Наличие автомобиля").count)} звонков`);
      setText("themeCredit", `${formatNumber(getTheme("Автокредит").count)} звонков`);
      setText("qualityPauses", `${formatNumber(getQuality("Длинные паузы").count)} (${formatPercent(getQuality("Длинные паузы").pct)})`);
      setText("longManualCredit", `${formatNumber(getLong("Ручной расчёт кредита").count)} (${formatPercent(getLong("Ручной расчёт кредита").pct)})`);
      setText("qualityNoNext", `${formatNumber(getQuality("Нет фиксации следующего шага").count)} (${formatPercent(getQuality("Нет фиксации следующего шага").pct)})`);

      setText("lossPrice", `${formatNumber(getDissat("Цена выше ожиданий").count)} (${formatPercent(getDissat("Цена выше ожиданий").pct)})`);
      setText("lossStock", `${formatNumber(getDissat("Отсутствие автомобиля в наличии").count)} (${formatPercent(getDissat("Отсутствие автомобиля в наличии").pct)})`);
      setText("lossDelivery", `${formatNumber(getDissat("Долгий срок поставки").count)} (${formatPercent(getDissat("Долгий срок поставки").pct)})`);
      setText("lossTrim", `${formatNumber(getDissat("Нет нужной комплектации").count)} (${formatPercent(getDissat("Нет нужной комплектации").pct)})`);
      setText("lossCredit", `${formatNumber(getDissat("Неоднозначные условия кредита").count)} (${formatPercent(getDissat("Неоднозначные условия кредита").pct)})`);

      setText("longManual", `${formatNumber(getLong("Ручной расчёт кредита").count)} (${formatPercent(getLong("Ручной расчёт кредита").pct)})`);
      setText("longStock", `${formatNumber(getLong("Нет актуального наличия авто").count)} (${formatPercent(getLong("Нет актуального наличия авто").pct)})`);
      setText("longSitePrice", `${formatNumber(getLong("Несовпадение цены на сайте").count)} (${formatPercent(getLong("Несовпадение цены на сайте").pct)})`);
      setText("longNoScript", `${formatNumber(getLong("Нет чёткого сценария консультации").count)} (${formatPercent(getLong("Нет чёткого сценария консультации").pct)})`);
      setText("longCreditExplain", `${formatNumber(getLong("Сложное объяснение кредитных условий").count)} (${formatPercent(getLong("Сложное объяснение кредитных условий").pct)})`);

      setText("critPrice", `${formatNumber(getTheme("Цена / скидки / акции").count)} звонков`);
      setText("critNext", `${formatNumber(getQuality("Нет фиксации следующего шага").count)} звонков`);
      setText("critCredit", `${formatNumber(getTheme("Автокредит").count)} звонков`);

      // Charts
      const themeLabels = themes.map((item) => item.label);
      const themeCounts = themes.map((item) => item.count);
      new Chart(document.getElementById("themesPie"), {
        type: "pie",
        data: {
          labels: themeLabels,
          datasets: [
            {
              data: themeCounts,
              backgroundColor: [
                "#ff3b3b",
                "#ff6b6b",
                "#ffffff",
                "#cbd5e1",
                "#94a3b8",
                "#6b7280",
                "#4b5563",
                "#374151",
                "#1f2937",
                "#111827",
                "#0b0c0f",
              ],
              borderWidth: 0,
            },
          ],
        },
        options: {
          plugins: {
            legend: {
              position: "right",
              labels: { boxWidth: 12, boxHeight: 12 },
            },
            tooltip: {
              callbacks: {
                label: (ctx) => {
                  const pct = themes[ctx.dataIndex]?.pct ?? 0;
                  return `${ctx.label}: ${formatNumber(ctx.raw)} (${formatPercent(pct)})`;
                },
              },
            },
          },
        },
      });

      const dissatLabels = dissatRows.map((item) => item.label);
      const dissatCounts = dissatRows.map((item) => item.count);
      new Chart(document.getElementById("dissatisfactionBar"), {
        type: "bar",
        data: {
          labels: dissatLabels,
          datasets: [
            {
              label: "Звонки",
              data: dissatCounts,
              backgroundColor: "#cbd5e1",
              borderRadius: 8,
            },
          ],
        },
        options: {
          indexAxis: "y",
          scales: {
            x: { grid: { color: palette.grid } },
            y: { grid: { display: false } },
          },
          plugins: { legend: { display: false } },
        },
      });

      const objLabels = objectionsRows.map((item) => item.label);
      const objCounts = objectionsRows.map((item) => item.count);
      new Chart(document.getElementById("objectionsBar"), {
        type: "bar",
        data: {
          labels: objLabels,
          datasets: [
            {
              label: "Звонки",
              data: objCounts,
              backgroundColor: "#ff6b6b",
              borderRadius: 8,
            },
          ],
        },
        options: {
          indexAxis: "y",
          scales: {
            x: { grid: { color: palette.grid } },
            y: { grid: { display: false } },
          },
          plugins: { legend: { display: false } },
        },
      });

      const qualLabels = qualityRows.map((item) => item.label);
      const qualCounts = qualityRows.map((item) => item.count);
      new Chart(document.getElementById("qualityBar"), {
        type: "bar",
        data: {
          labels: qualLabels,
          datasets: [
            {
              label: "Звонки",
              data: qualCounts,
              backgroundColor: "#94a3b8",
              borderRadius: 8,
            },
          ],
        },
        options: {
          indexAxis: "y",
          scales: {
            x: { grid: { color: palette.grid } },
            y: { grid: { display: false } },
          },
          plugins: { legend: { display: false } },
        },
      });

      const longLabels = longRows.map((item) => item.label);
      const operationalReasons = [
        "Сложное объяснение кредитных условий",
        "Ручной расчёт кредита",
        "Нет чёткого сценария консультации",
      ];
      const infoReasons = ["Нет актуального наличия авто", "Несовпадение цены на сайте"];
      const operationalValues = longRows.map((row) =>
        operationalReasons.includes(row.label) ? row.count : 0
      );
      const infoValues = longRows.map((row) => (infoReasons.includes(row.label) ? row.count : 0));

      new Chart(document.getElementById("longCallsStacked"), {
        type: "bar",
        data: {
          labels: longLabels,
          datasets: [
            {
              label: "Процесс",
              data: operationalValues,
              backgroundColor: "#f1f5f9",
              borderRadius: 6,
              stack: "stack1",
            },
            {
              label: "Информация",
              data: infoValues,
              backgroundColor: "#ff3b3b",
              borderRadius: 6,
              stack: "stack1",
            },
          ],
        },
        options: {
          indexAxis: "y",
          scales: {
            x: { grid: { color: palette.grid } },
            y: { grid: { display: false } },
          },
        },
      });

      const modelLabels = modelRows.map((row) => row.label);
      const modelPrice = modelRows.map((row) => row.price);
      const modelAvailability = modelRows.map((row) => row.availability);
      if (modelLabels.length) {
        new Chart(document.getElementById("modelObjections"), {
          type: "bar",
          data: {
            labels: modelLabels,
            datasets: [
              {
                label: "Цена",
                data: modelPrice,
                backgroundColor: "#ff6b6b",
                borderRadius: 6,
                stack: "stack1",
              },
              {
                label: "Наличие / ожидание",
                data: modelAvailability,
                backgroundColor: "#cbd5e1",
                borderRadius: 6,
                stack: "stack1",
              },
            ],
          },
          options: {
            scales: {
              x: { grid: { display: false } },
              y: { grid: { color: palette.grid } },
            },
          },
        });
      }
    </script>
  </body>
</html>
